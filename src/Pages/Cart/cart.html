<!DOCTYPE html>
{% load static %}
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="static-base" content="/" />
  <title>Giỏ hàng - Hồng Trà Ngô Gia</title>
  <link rel="icon" type="image/png" href="{% static 'assets/images/logo-divider.png' %}">
  <link rel="stylesheet" href="{% static 'Pages/Cart/cart.css' %}">
</head>
<body>
  <div id="app-header"></div>

  <main class="cart-page">
    <section class="page-hero">
      <div class="hero-content">
        <h1>Thanh toán</h1>
        <nav class="breadcrumb" aria-label="breadcrumbs">
          <a href="/">Trang chủ</a>
          <span aria-hidden="true">/</span>
          <span>Giỏ hàng</span>
        </nav>
      </div>
    </section>

    <section class="checkout-layout">
      <article class="panel shipping-panel">
        <div class="panel-head">
          <h2>Thông tin giao hàng</h2>
        </div>
        <dl class="shipping-info" id="shipping-info">
        </dl>
      </article>
      <article class="panel cart-panel">
        <div class="panel-head">
          <h2>Giỏ hàng của bạn</h2>
          <span class="count" id="cart-count">0 món</span>
        </div>
        <div class="cart-list" id="cart-list" aria-live="polite">
          <!-- items inserted via JS -->
        </div>
        <section class="totals" aria-label="Thông tin thanh toán">
          <h3>Thông tin thanh toán</h3>
          <div class="coupon-tools">
            <button type="button" class="coupon-btn" id="btn-coupon">Nhập mã giảm giá</button>
            <span class="coupon-status" id="coupon-label">Chưa áp dụng</span>
          </div>
          <dl>
            <div>
              <dt>Tổng tiền tạm tính</dt>
              <dd id="total-sub">0₫</dd>
            </div>
            <div>
              <dt>Phí vận chuyển</dt>
              <dd id="total-ship">0₫</dd>
            </div>
            <div>
              <dt>Mã giảm giá</dt>
              <dd id="total-discount">0₫</dd>
            </div>
            <div class="grand">
              <dt>Tổng cộng</dt>
              <dd id="total-grand">0₫</dd>
            </div>
          </dl>
        </section>

        <section class="payment-method" aria-label="Phương thức thanh toán">
          <h3>Phương thức thanh toán</h3>
          <label><input type="radio" name="payment" value="cash" checked> Tiền mặt</label>
          <label><input type="radio" name="payment" value="momo"> MoMo</label>
          <label><input type="radio" name="payment" value="zalopay"> ZaloPay</label>
          <label><input type="radio" name="payment" value="ewallet"> Ví điện tử</label>
        </section>

        <label class="terms">
          <input type="checkbox" id="agree-terms">
          <span>Tôi đã đọc, hiểu và đồng ý với tất cả các điều khoản, điều kiện và chính sách liên quan</span>
        </label>

        <button class="checkout-btn" id="btn-checkout" type="button">Tiến hành thanh toán</button>
      </article>
    </section>
  </main>

  <div id="cart-modal-root"></div>

  <!-- Alert Modal HTML - checkout -->
  <div id="alert-overlay" class="alert-overlay" role="dialog" aria-modal="true">
    <div id="alert-dialog" class="alert-dialog">
      <div class="alert-icon" id="alert-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
      </div>
      <h3 id="alert-title" class="alert-title"></h3>
      <p id="alert-message" class="alert-message"></p>
      <div class="alert-actions" id="alert-actions">
        <button type="button" class="alert-btn alert-btn-primary" id="alert-confirm">OK</button>
      </div>
    </div>
  </div>

  <div id="app-footer"></div>
  
  <script>
  window.showAlert = function(type, title, message, isConfirm) {
    const overlay = document.getElementById('alert-overlay');
    const dialog = document.getElementById('alert-dialog');
    const iconEl = document.getElementById('alert-icon');
    const titleEl = document.getElementById('alert-title');
    const messageEl = document.getElementById('alert-message');
    const actionsEl = document.getElementById('alert-actions');

    if (!overlay || !dialog || !iconEl || !titleEl || !messageEl || !actionsEl) {
      console.error('Alert elements not found');
      return Promise.resolve(false);
    }

    titleEl.textContent = title || '';
    messageEl.textContent = message || '';
    dialog.className = 'alert-dialog alert-' + (type || 'info');

    const icons = {
      // ✅ THAY ĐỔI: Icon warning với dấu chấm than
      warning: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>',
      info: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>',
      confirm: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9 12l2 2 4-4"></path></svg>'
    };
    iconEl.innerHTML = icons[type] || icons.info;

    if (isConfirm) {
      actionsEl.innerHTML = `
        <button type="button" class="alert-btn alert-btn-secondary" id="alert-cancel">Hủy</button>
        <button type="button" class="alert-btn alert-btn-primary" id="alert-confirm">Xác nhận</button>
      `;
    } else {
      actionsEl.innerHTML = `
        <button type="button" class="alert-btn alert-btn-primary" id="alert-confirm">OK</button>
      `;
    }

    overlay.classList.add('show');
    document.body.classList.add('alert-open');

    return new Promise(function(resolve) {
      const confirmBtn = document.getElementById('alert-confirm');
      const cancelBtn = document.getElementById('alert-cancel');

      function close(result) {
        overlay.classList.remove('show');
        document.body.classList.remove('alert-open');
        resolve(result);
      }

      if (confirmBtn) confirmBtn.onclick = function() { close(true); };
      if (cancelBtn) cancelBtn.onclick = function() { close(false); };

      if (!isConfirm) {
        overlay.onclick = function(e) {
          if (e.target === overlay) close(false);
        };
      }

      function onKeyDown(evt) {
        if (evt.key === 'Escape' && !isConfirm) {
          close(false);
          document.removeEventListener('keydown', onKeyDown);
        }
      }
      document.addEventListener('keydown', onKeyDown);
    });
  };
</script>
  
  <script src="{% static 'assets/js/app.js' %}" defer></script>
  <script src="{% static 'Pages/Cart/cart.js' %}" defer></script>
</body>
</html>
